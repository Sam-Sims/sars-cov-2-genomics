<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>SARS-CoV-2 Genomics</title>

<script src="site_libs/header-attrs-2.16/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<link rel="stylesheet" href="assets/styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">UoC BioinfoTraining</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li>
  <a href="101-setup.html">
    <span class="fa fa-gear"></span>
     
    Setup
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-file-lines"></span>
     
    Materials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">The Unix Shell</a>
      <ul class="dropdown-menu" role="menu">
        <li>
          <a href="02a-unix_intro.html">Intro to Unix</a>
        </li>
        <li>
          <a href="02b-unix_files_directories.html">Files and Directories</a>
        </li>
        <li>
          <a href="02c-unix_text_manipulation.html">Text Manipulation</a>
        </li>
        <li>
          <a href="02d-unix_pipes.html">Combining Commands &amp; Writing Scripts</a>
        </li>
      </ul>
    </li>
    <li>
      <a href="01-intro.html">SARS-CoV-2 Genomic Surveillance</a>
    </li>
    <li>
      <a href="03-intro_ngs.html">Intro to NGS Data</a>
    </li>
    <li>
      <a href="04-consensus.html">Consensus Assembly</a>
    </li>
    <li>
      <a href="05-lineage_analysis.html">Lineages and Variants</a>
    </li>
    <li>
      <a href="06-phylogeny.html">Building Phylogenies</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-book"></span>
     
    Extras
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="102-unix_cheatsheet.html">Unix Cheatsheet</a>
    </li>
    <li>
      <a href="106-file_formats.html">Common File Formats</a>
    </li>
    <li>
      <a href="104-wsl_windows.html">Windows Subsystem for Linux</a>
    </li>
    <li>
      <a href="105-vs_code.html">Visual Studio Code</a>
    </li>
    <li>
      <a href="103-tools_and_resources.html">SARS-CoV-2 Resources</a>
    </li>
  </ul>
</li>
<li>
  <a href="100-homework.html">
    <span class="fa fa-pencil"></span>
     
    Homework
  </a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/cambiotraining/sars-cov-2-genomics">
    <span class="fa fa-brands fa-github"></span>
     
    Github
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">




</div>


<div id="the-unix-shell-text-manipulation" class="section level1">
<h1>The Unix Shell: Text Manipulation</h1>
<div class="highlight">
<p><strong>Questions</strong></p>
<ul>
<li>How can I inspect the content of and manipulate text files?</li>
<li>How can I find and replace text patterns within files?</li>
</ul>
<p><strong>Learning Objectives</strong></p>
<ul>
<li>Inspect the content of text files (<code>head</code>, <code>tail</code>, <code>cat</code>, <code>zcat</code>, <code>less</code>).</li>
<li>Use the <code>*</code> wildcard to work with multiple files at once.</li>
<li>Redirect the output of a command to a file (<code>&gt;</code>, <code>&gt;&gt;</code>).</li>
<li>Find a pattern in a text file (<code>grep</code>) and do basic pattern replacement (<code>sed</code>).</li>
</ul>
</div>
<div class="note">
<p>This section has an accompanying <a href="https://docs.google.com/presentation/d/1DJFWHu9sbJx3CmexGFxhb6gbK5gOmuXpPMEH8Mj-Sk4/edit?usp=sharing" target="_blank">slide deck</a>.</p>
</div>
<div id="looking-inside-files" class="section level2">
<h2>Looking Inside Files</h2>
<p>Often we want to investigate the content of a file, without having to open it in a text editor. This is especially useful if the file is very large (as is often the case in bioinformatic applications).</p>
<p>For example, let’s take a look at the file <code>artic_primers_pool1.bed</code>. We will start by printing the whole content of the file with the <code>cat</code> command, which stands for “concatenate” (we will see why it’s called this way in a little while):</p>
<pre class="console"><code>$ cat artic_primers_pool1.bed</code></pre>
<p>This outputs a lot of text, because the file is quite long!</p>
<p>Instead, it is often more useful to look only at the top few lines of the file. We can do this with the <code>head</code> command:</p>
<pre class="console"><code>$ head artic_primers_pool1.bed</code></pre>
<pre><code>MN908947.3  30  54  nCoV-2019_1_LEFT    1   +
MN908947.3  385 410 nCoV-2019_1_RIGHT   1   -
MN908947.3  642 664 nCoV-2019_3_LEFT    1   +
MN908947.3  1004    1028    nCoV-2019_3_RIGHT   1   -
MN908947.3  1242    1264    nCoV-2019_5_LEFT    1   +
MN908947.3  1623    1651    nCoV-2019_5_RIGHT   1   -
MN908947.3  1875    1897    nCoV-2019_7_LEFT    1   +
MN908947.3  1868    1890    nCoV-2019_7_LEFT_alt0   1   +
MN908947.3  2247    2269    nCoV-2019_7_RIGHT   1   -
MN908947.3  2242    2264    nCoV-2019_7_RIGHT_alt5  1   -</code></pre>
<p>By default, <code>head</code> prints the first 10 lines of the file. We can change this using the <code>-n</code> option, followed by a number, for example:</p>
<pre class="console"><code>$ head -n 2 artic_primers_pool1.bed</code></pre>
<pre><code>MN908947.3  30  54  nCoV-2019_1_LEFT    1   +
MN908947.3  385 410 nCoV-2019_1_RIGHT   1   -</code></pre>
<p>Similarly, we can look at the <em>bottom</em> few lines of a file with the <code>tail</code> command:</p>
<pre class="console"><code>$ tail -n 2 artic_primers_pool1.bed</code></pre>
<pre><code>MN908947.3  29288   29316   nCoV-2019_97_LEFT   1   +
MN908947.3  29665   29693   nCoV-2019_97_RIGHT  1   -</code></pre>
<p>Finally, if we want to open the file and browse through it, we can use the <code>less</code> command:</p>
<pre class="console"><code>$ less artic_primers_pool1.bed</code></pre>
<p><code>less</code> will open the file and you can use <kbd>↑</kbd> and <kbd>↓</kbd> to move line-by-line or the <kbd>Page Up</kbd> and <kbd>Page Down</kbd> keys to move page-by-page. You can exit <code>less</code> by pressing <kbd>Q</kbd> (for “quit”). This will bring you back to the console.</p>
<p>Finally, it can sometimes be useful to <em>count</em> how many lines, words and characters a file has. We can use the <code>wc</code> command for this:</p>
<pre class="console"><code>wc artic_primers_pool*.bed</code></pre>
<pre><code>110  660 4961 artic_primers_pool1.bed
108  648 4878 artic_primers_pool2.bed
218 1308 9839 total</code></pre>
<p>In this case, we used the <code>*</code> wildcard to count lines, words and characters (in that order, left-to-right) of both our primer files. Often, we only want to count one of these things, and <code>wc</code> has options for all of them:</p>
<ul>
<li><code>-l</code> counts lines only.</li>
<li><code>-w</code> counts words only.</li>
<li><code>-c</code> counts characters only.</li>
</ul>
<p>For example, if we just want to know how many primers we have (the number of lines in the files):</p>
<pre class="console"><code>wc -l artic_primers_pool*.bed</code></pre>
<pre><code>110  artic_primers_pool1.bed
108  artic_primers_pool2.bed
218  total</code></pre>
<div class="exercise">
<ul>
<li>Use the <code>less</code> command to look inside the file <code>data/reference_genome.fa</code>.</li>
<li>How many lines does this file contain?</li>
<li>Use the <code>less</code> command again but with the option <code>-S</code>. Can you understand what this option does?</li>
</ul>
<details>
<summary>
Answer
</summary>
<p>We can investigate the content of the reference file using <code>less data/reference_genome.fa</code>. From this view, it looks like this file contains several lines of content: the genome is almost 30kb long, so it’s not surprising we see so much text! We can use <kbd>Q</kbd> to quit and go back to the console.</p>
<p>To check the number of lines in the file, we can use the <code>wc -l data/reference_genome.fa</code> command. The answer is only 2.</p>
<p>If we use <code>less -S data/reference_genome.fa</code> the display is different this time. We see only two lines in the output. If we use the <kbd>→</kbd> and <kbd>←</kbd> arrows we can see that the text now goes “out of the screen”. So, what happens is that by default <code>less</code> will “wrap” long lines, so if a line of text is too long, it will continue it on the next line of the screen. When we use the option <code>-S</code> it instead displays each line individually, and we can use the arrow keys to see the content that does not fit on the screen.</p>
</details>
</div>
<div class="note">
<p>The primer files we just looked into are in a format called <a href="https://en.wikipedia.org/wiki/BED_(file_format)">BED</a>. This is a standard bioinformatic file format used to store coordinates of genomic regions. In this case, it corresponds to the coordinates of each primer start and end position in the SARS-CoV-2 reference genome (Wuhan-Hu-1).</p>
<p>In the exercise we looked at another standard file format called <a href="https://en.wikipedia.org/wiki/FASTA">FASTA</a>. This one is used to store nucleotide or amino acid sequences. In this case, the complete nucleotide sequence of the SARS-CoV-2 reference genome.</p>
<p>We will learn more about these files in <a href="03-intro_ngs.html">Intro to NGS</a>.</p>
</div>
</div>
<div id="combining-several-files" class="section level2">
<h2>Combining several files</h2>
<p>We said that the <code>cat</code> command we used above stands for “concatenate”. This is because this command can be used to <em>concatenate</em> (combine) several files together. For example, if we wanted to combine both sets of primer pools into a single file:</p>
<pre class="console"><code>cat artic_primers_pool1.bed artic_primers_pool2.bed</code></pre>
</div>
<div id="redirecting-output" class="section level2">
<h2>Redirecting Output</h2>
<p>The <code>cat</code> command we just used printed the output to the screen. But what if we wanted to save it into a file? We can achieve this by sending (or <em>redirecting</em>) the output of the command to a file using the <code>&gt;</code> operator.</p>
<pre class="console"><code>cat artic_primers_pool1.bed artic_primers_pool2.bed &gt; artic_primers.bed</code></pre>
<p>Now, the output is not printed to the console, but instead sent to a new file. We can check that the file was created with <code>ls</code>.</p>
<p>If we use <code>&gt;</code> and the output file already exists, its content will be replaced. If what we want to do is <em>append</em> the result of the command to the existing file, we should use <code>&gt;&gt;</code> instead. Let’s see this in practice in the next exercise.</p>
<div class="exercise">
<ol style="list-style-type: decimal">
<li>List the files in the <code>data/sequencing_run1/</code> directory. Save the output in a file called “sequencing_files.txt”.</li>
<li>What happens if you run the command <code>ls data/sequencing_run2/ &gt; sequencing_files.txt</code>?</li>
<li>The operator <code>&gt;&gt;</code> can be used to <em>append</em> the output of a command to an existing file. Try re-running both of the previous commands, but instead using the <code>&gt;&gt;</code> operator. What happens now?</li>
</ol>
<details>
<summary>
Answer
</summary>
<p><strong>Task 1</strong></p>
<p>To list the files in the directory we use <code>ls</code>, followed by <code>&gt;</code> to save the output in a file:</p>
<pre class="console"><code>$ ls data/sequencing_run1/ &gt; sequencing_files.txt</code></pre>
<p>We can check the content of the file:</p>
<pre class="console"><code>$ cat sequencing_files.txt</code></pre>
<pre><code>sample1_run1.fastq
sample2_run1.fastq
sample3_run1.fastq
sample4_run1.fastq</code></pre>
<hr />
<p><strong>Task 2</strong></p>
<p>If we run <code>ls data/sequencing_run2/ &gt; sequencing_files.txt</code>, we will replace the content of the file:</p>
<pre class="console"><code>$ cat sequencing_files.txt</code></pre>
<pre><code>sample1_run2.fastq
sample2_run2.fastq
sample3_run2.fastq
sample4_run2.fastq
sample5_run2.fastq
sample6_run2.fastq</code></pre>
<hr />
<p><strong>Task 3</strong></p>
<p>If we start again from the beggining, but instead use the <code>&gt;&gt;</code> operator the second time we run the command, we will append the output to the file instead of replacing it:</p>
<pre class="console"><code>$ ls data/sequencing_run1/ &gt; sequencing_files.txt
$ ls data/sequencing_run2/ &gt;&gt; sequencing_files.txt
$ cat sequencing_files.txt</code></pre>
<pre><code>sample1_run1.fastq
sample2_run1.fastq
sample3_run1.fastq
sample4_run1.fastq
sample1_run2.fastq
sample2_run2.fastq
sample3_run2.fastq
sample4_run2.fastq
sample5_run2.fastq
sample6_run2.fastq</code></pre>
</details>
</div>
</div>
<div id="finding-patterns" class="section level2">
<h2>Finding Patterns</h2>
<p>Something it can be very useful to find lines of a file that match a particular text pattern. We can use the tool <code>grep</code> (“global regular expression print”) to achieve this. For example, let’s find the word “nCoV-2019_46” in our primers file:</p>
<pre class="console"><code>$ grep &quot;nCoV-2019_46&quot; artic_primers.bed</code></pre>
<pre><code>MN908947.3  13599   13621   nCoV-2019_46_LEFT   2   +
MN908947.3  13602   13625   nCoV-2019_46_LEFT_alt1  2   +
MN908947.3  13962   13984   nCoV-2019_46_RIGHT  2   -
MN908947.3  13961   13984   nCoV-2019_46_RIGHT_alt2 2   -</code></pre>
<p>We can see the result is all the lines that matched this word pattern.</p>
<div class="exercise">
<p>Consider the file we previously saved in <code>results/variants.tsv</code>. (Note, if you don’t have this file, run the following commands: <code>mkdir -p results; mv output.tsv results/variants.tsv</code>)</p>
<ol style="list-style-type: decimal">
<li>Create a new file called <code>results/alpha.tsv</code> that contains only the Alpha variant samples.
<details>
<summary>
Hint
</summary>
You can use <code>grep</code> to find a pattern in a file. You can use <code>&gt;</code> to <em>redirect</em> the output of a command to a new file.
</details></li>
<li>How many samples are you left with?</li>
</ol>
<details>
<summary>
Answer
</summary>
<p><strong>Task 1</strong></p>
<p>We can use <code>grep</code> to find a pattern in our text file and use <code>&gt;</code> to save the output in a new file:</p>
<pre class="console"><code>$ grep &quot;Alpha&quot; results/variants.tsv &gt; results/alpha.tsv</code></pre>
<p>We could investigate the output of our command using <code>less results/alpha.tsv</code>.</p>
<hr />
<p><strong>Task 2</strong></p>
<p>We can use <code>wc</code> to count the lines of the newly created file:</p>
<pre class="console"><code>$ wc -l results/alpha.tsv</code></pre>
<p>Giving us 31 as the result.</p>
</details>
</div>
</div>
<div id="text-replacement" class="section level2">
<h2>Text Replacement</h2>
<p>One of the most prominent text-processing utilities is the <code>sed</code> command, which is short for “stream editor”. A stream editor is used to perform basic text transformations on an input stream (a file or input from a pipeline).</p>
<p><code>sed</code> contains several sub-commands, but the main one we will use is the <em>substitute</em> or <code>s</code> command. The syntax is:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sed</span> <span class="st">&#39;s/pattern/replacement/options&#39;</span></span></code></pre></div>
<p>Where <code>pattern</code> is the word we want to substitute and <code>replacement</code> is the new word we want to use instead. There are also other “options” added at the end of the command, which change the default behaviour of the text substitution. Some of the common options are:</p>
<ul>
<li><code>g</code>: by default <code>sed</code> will only substitute the first match of the pattern. If we use the <code>g</code> option (“<strong>g</strong>lobal”), then <code>sed</code> will substitute all matching text.</li>
<li><code>i</code>: by default <code>sed</code> matches the pattern in a case-sensitive manner. For example ‘A’ (Uppercase A) and ‘a’ (Lowercase A) are treated as different. If we use the <code>i</code> option (“case-<strong>i</strong>nsensitive”) then <code>sed</code> will treat ‘A’ and ‘a’ as the same.</li>
</ul>
<p>For example, let’s create a file with some text inside it:</p>
<pre class="console"><code>$ echo &quot;Hello world. How are you world?&quot; &gt; hello.txt</code></pre>
<p>(Note: the <code>echo</code> command is used to print some text on the console. In this case we are sending that text to a file to use in our example.)</p>
<p>If we do:</p>
<pre class="console"><code>$ sed &#39;s/world/participant/&#39; hello.txt</code></pre>
<p>This is the result</p>
<pre><code>Hello participant. How are you world?</code></pre>
<p>We can see that the first “world” word was replaced with “participant”. This is the default behaviour of <code>sed</code>: only the first pattern it finds in a line of text is replaced with the new word. We can modify this by using the <code>g</code> option after the last <code>/</code>:</p>
<pre class="console"><code>$ sed &#39;s/world/participant/g&#39; hello.txt</code></pre>
<pre><code>Hello participant. How are you participant?</code></pre>
<div class="note">
<p><strong>Regular Expressions</strong></p>
<p>Finding patterns in text can be a very powerful skill to master. In our examples we have been finding a literal word and replacing it with another word. However, we can do more complex text substitutions by using special keywords that define a more general pattern. These are known as <strong>regular expressions</strong>.</p>
<p>For example, in regular expression syntax, the character <code>.</code> stands for “any character”. So, for example, the pattern <code>H.</code> would match a “H” followed by any character, and the expression:</p>
<pre class="console"><code>$ sed &#39;s/H./X/g&#39; hello.txt</code></pre>
<p>Results in:</p>
<pre><code>Xllo world. Xw are you world?</code></pre>
<p>Notice how both “He” (at the start of the word “Hello”) and “Ho” (at the start of the word “How”) are replaced with the letter “X”. Because both of them match the pattern “H followed by any character” (<code>H.</code>).</p>
<p>To learn more see this <a href="https://www.keycdn.com/support/regex-cheatsheet">Regular Expression Cheatsheet</a>.</p>
</div>
<div id="the-escape-character" class="section level3">
<h3>The <code>\</code> Escape Character</h3>
<p>You may have asked yourself, if the <code>/</code> character is used to separate parts of the <code>sed</code> substitute command, then how would we replace the “/” character itself in a piece of text? For example, let’s add a new line of text to our file:</p>
<pre class="console"><code>$ echo &quot;Welcome to this workshop/course.&quot; &gt;&gt; hello.txt</code></pre>
<p>Let’s say we wanted to replace “workshop/course” with “tutorial” in this text. If we did:</p>
<pre class="console"><code>$ sed &#39;s/workshop/course/tutorial/&#39; hello.txt</code></pre>
<p>We would get an error:</p>
<pre><code>sed: -e expression #1, char 5: unknown option to `s&#39;</code></pre>
<p>This is because we ended up with too many <code>/</code> in the command, and <code>sed</code> uses that to separate its different parts of the command. In this situation we need to tell <code>sed</code> to ignore that <code>/</code> as being a special character but instead treat it as the literal “/” character. To to this, we need to use <code>\</code> before <code>/</code>, which is called the “escape” character. That will tell <code>sed</code> to treat the <code>/</code> as a normal character rather than a separator of its commands. So:</p>
<pre class="console"><code>$ sed &#39;s/workshop\/course/tutorial/&#39; hello.txt
                  ↑
             This / is &quot;escaped&quot; with \ beforehand</code></pre>
<p>This looks a little strange, but the main thing to remember is that <code>\/</code> will be interpreted as the character “/” rather than the separator of <code>sed</code>’s substitute command.</p>
<div class="exercise">
<p>The file in <code>data/envelope_protein.fa</code> contains the amino acid sequence of the SARS-CoV-2 envelope protein for 4 patient samples.</p>
<pre class="console"><code>$ cat data/envelope_protein.fa</code></pre>
<pre><code>&gt;patient01
MYSFVSEETGTLIVNSVLLFLAFVVFLLVTLAILTALRLCAYCCNIVNVSLVKPSFYVYSRVKNLNSSRVPDLLV*
&gt;Patient02/incomplete
MYSFVSEETGTLIVNSVLLFLAFVVFLLVTLAILTALRLCAYCCNIVNLSLVKPSFY...................
&gt;sample04
MYSFVSEETGTLIVNSVLLFLAFVVFLLVTLAILTALRLCAYCCNIVNVSLVKPSFYVYSRVKNLNSSRVPDLLV*
&gt;Sample05
MYSFVSEETGTLIVNSVLLFLAFVVFLLVTLAILTALRLCAYCCNIVNVSLVKPSFYVYSRVKNLNSSRVPDLLV*</code></pre>
<p>We will cover FASTA files in the following section, for now all we need to know is that each sequence has a name in a line that starts with the character <code>&gt;</code>.</p>
<p>Use <code>sed</code> to achive the following:</p>
<ol style="list-style-type: decimal">
<li>Substitute the word <code>patient</code> with <code>sample</code>.
<details>
<summary>
Hint
</summary>
Similarly to how you can use the <code>g</code> option to go “global” substitution, you can also use the <code>i</code> option to do case-<strong>i</strong>nsensitive text substitution.
</details></li>
<li>Substitute the word <code>/incomplete</code> with <code>-missing</code>.</li>
<li>The character <code>.</code> is also a keyword used in <em>regular expressions</em> to mean “any character”. See what happens if you run the command <code>sed 's/./X/g' data/envelope_protein.fa</code>. How would you fix this command to literally only substitute the character <code>.</code> with <code>X</code>?</li>
</ol>
<details>
<summary>
Answer
</summary>
<p><strong>Task 1</strong></p>
<p>To replace the word <code>patient</code> with <code>sample</code>, we can do:</p>
<pre class="console"><code>$ sed &#39;s/patient/sample/i&#39; data/envelope_protein.fa</code></pre>
<pre><code>&gt;sample01
MYSFVSEETGTLIVNSVLLFLAFVVFLLVTLAILTALRLCAYCCNIVNVSLVKPSFYVYSRVKNLNSSRVPDLLV*
&gt;sample02/incomplete
MYSFVSEETGTLIVNSVLLFLAFVVFLLVTLAILTALRLCAYCCNIVNLSLVKPSFY...................
&gt;sample04
MYSFVSEETGTLIVNSVLLFLAFVVFLLVTLAILTALRLCAYCCNIVNVSLVKPSFYVYSRVKNLNSSRVPDLLV*
&gt;Sample05
MYSFVSEETGTLIVNSVLLFLAFVVFLLVTLAILTALRLCAYCCNIVNVSLVKPSFYVYSRVKNLNSSRVPDLLV*</code></pre>
<p>We have to use the option <code>i</code> to tell the <code>sed</code> that we want to match the word <code>patient</code> in case-insensitive manner.</p>
<hr />
<p><strong>Task 2</strong></p>
<p>For the second task, if we do:</p>
<pre class="console"><code>$ sed &#39;s//incomplete/-missing/&#39;  data/envelope_protein.fa</code></pre>
<p>We will get an error. We need to use <code>\</code> to <em>escape</em> the <code>/</code> keyword in our pattern, so:</p>
<pre class="console"><code>$ sed &#39;s/\/incomplete/-missing/&#39;  data/envelope_protein.fa</code></pre>
<pre><code>&gt;patient01
MYSFVSEETGTLIVNSVLLFLAFVVFLLVTLAILTALRLCAYCCNIVNVSLVKPSFYVYSRVKNLNSSRVPDLLV*
&gt;Patient02-missing
MYSFVSEETGTLIVNSVLLFLAFVVFLLVTLAILTALRLCAYCCNIVNLSLVKPSFY...................
&gt;sample04
MYSFVSEETGTLIVNSVLLFLAFVVFLLVTLAILTALRLCAYCCNIVNVSLVKPSFYVYSRVKNLNSSRVPDLLV*
&gt;Sample05
MYSFVSEETGTLIVNSVLLFLAFVVFLLVTLAILTALRLCAYCCNIVNVSLVKPSFYVYSRVKNLNSSRVPDLLV*</code></pre>
<hr />
<p><strong>Task 3</strong></p>
<p>Finally, to replace the character <code>.</code>, if we do:</p>
<pre class="console"><code>$ sed &#39;s/./X/g&#39; data/envelope_protein.fa</code></pre>
<pre><code>XXXXXXXXXX
XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
XXXXXXXXX
XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
XXXXXXXXX
XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</code></pre>
<p>Everything becomes “X”! That’s because <code>.</code> is a keyword used in <em>regular expressions</em> to mean “any character”. Because we are using the <code>g</code> option (for “global substitution”), we replaced every single character with “X”. To literally replace the character “.”, we need to again use the <code>\</code> escape character, so:</p>
<pre class="console"><code>$ sed &#39;s/\./X/g&#39; data/envelope_protein.fa</code></pre>
<pre><code>&gt;patient01
MYSFVSEETGTLIVNSVLLFLAFVVFLLVTLAILTALRLCAYCCNIVNVSLVKPSFYVYSRVKNLNSSRVPDLLV*
&gt;Patient02/incomplete
MYSFVSEETGTLIVNSVLLFLAFVVFLLVTLAILTALRLCAYCCNIVNLSLVKPSFYXXXXXXXXXXXXXXXXXXX
&gt;sample04
MYSFVSEETGTLIVNSVLLFLAFVVFLLVTLAILTALRLCAYCCNIVNVSLVKPSFYVYSRVKNLNSSRVPDLLV*
&gt;Sample05
MYSFVSEETGTLIVNSVLLFLAFVVFLLVTLAILTALRLCAYCCNIVNVSLVKPSFYVYSRVKNLNSSRVPDLLV*</code></pre>
</details>
</div>
</div>
</div>
<div id="summary" class="section level2">
<h2>Summary</h2>
<div class="highlight">
<p><strong>Key Points</strong></p>
<ul>
<li>The <code>head</code> and <code>tail</code> commands can be used to look at the top or bottom of a file, respectively.</li>
<li>The <code>less</code> command can be used to interactively investigate the content of a file. Use <kbd>↑</kbd> and <kbd>↓</kbd> to browse the file and <kbd>Q</kbd> to quit and return to the console.</li>
<li>The <code>cat</code> command can be used to combine multiple files together. The <code>zcat</code> command can be used instead if the files are compressed.</li>
<li>The <code>&gt;</code> operator redirects the output of a command into a file. If the file already exists, it’s content will be overwritten.</li>
<li>The <code>&gt;&gt;</code> operator also redictects the output of a command into a file, but <em>appends</em> it to any content that already exists.</li>
<li>The <code>grep</code> command can be used to find the lines in a text file that match a text pattern.</li>
<li>The <code>sed</code> tool can be used for advanced text manipulation. The “substitute” command can be used to text replacement: <code>sed 's/pattern/replacement/options'</code>.</li>
</ul>
</div>
</div>
</div>

<!DOCTYPE html>
<html>
<head>
<style>
* {
  box-sizing: border-box;
}

.img-container-left {
  float: left;
  width: 33.33%;
  padding: 15px;
}

.img-container-right {
  float: right;
  width: 33.33%;
  padding: 15px;
}

.clearfix::after {
  content: "";
  clear: both;
  display: table;
}
</style>
</head>
<body>

<hr>
<div class="clearfix">
  <div class="img-container-left">
    <img src="assets/img/logo_btf.png" alt="UoC Bioinformatics Training Facility" style="width:100%">
  </div>
  <div class="img-container-right">
    <img src="assets/img/logo_ukhsa.svg" alt="UK Public Health England" style="width:40%">
  </div>
</div>

</body>
</html>





</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
